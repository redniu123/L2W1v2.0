# D) 对比实验方案（SH‑DA++ Comparisons，重写版）

> 核心：在相同预算 \(B\) 下横向对齐各路由策略，验证 SH‑DA++ 在边界失效检测（boundary deletion）与 CER–Budget 前沿上的优势。[file:3]

## D1. 实验目标与公平性约束

### 目标

对比传统置信度路由、位置敏感置信度、语义路由、机制信号路由与 SH‑DA++，证明 SH‑DA++ 在预算约束下对“空间感知失效（boundary deletion）”具有更强检出与更优效率前沿。[file:3]

### 统一设置（所有方法一致）

- 固定 Agent A：PP‑OCRv5；固定 Agent B：Qwen2.5‑VL‑3B；解码参数（temperature/top_p/max_tokens）一致。[file:3]
- 预算点：\(B\in\{10\%,20\%,30\%\}\)。[file:3]
- 所有方法必须报告并满足 `Actual Call Rate = B ± 0.5%`，否则该点无效（需重跑）。[file:3]
- 阈值策略：[file:3]
  - **在线控制组**：比例在线控制更新 \(\lambda\)（按 Stage3 协议），自然达标预算。[file:3]
  - **固定阈值组**：Validation Set 搜索 \(\lambda\_{fix}\) 使调用率最接近 B，冻结用于 Test（禁止 Test 调参）。[file:3]
- 校准与任何超参搜索仅限 Validation；Test 只出最终报表。[file:3]

---

## D2. 四梯队基线体系（Baseline Tiers）

> 每个 baseline 必须给出：routing score \(q(x)\) 定义、阈值/控制方式、以及在 \(B\) 下最终 call rate。[file:3]

### Tier‑0：性能上下限（Upper/Lower Bounds）

- **Agent A only**：不升级，\(B=0\%\)（下限）。[file:3]
- **Agent B only**：每行强制调用 VLM，\(B=100\%\)（理论上限；作为 token/latency 归一化基准）。[file:3]

### Tier‑1：传统置信度路由（Confidence Routing）

- **Global avg_conf**：\(q=\text{mean}\_i(p_i)\) 或 \(q=1-\text{mean}\_i(p_i)\)（二选一写死），阈值/控制器对齐预算。[file:3]
- **NUTV（Pos‑aware conf）**：位置加权置信度，例如
  \[
  q = 1-\sum_i w_i p_i
  \]
  在首尾区域权重更大（必须明确权重形式与 \(\rho\) 对齐），但不引入 blank/视觉机制信号。[file:3]

> 该梯队用于证明“仅调 conf 权重”对边界高置信漏字无机制性覆盖。[file:3]

### Tier‑2：语义与文本一致性路由（Semantic/Text-only）

- **PPL-only**：仅用 Sentinel 输出困惑度/风险 \(r_d\) 路由（\(q=r_d\)），不看图像边缘与 CTC blank。[file:3]

> 该梯队用于证明“语义异常”不足以稳定捕捉纯视觉边界漏字，尤其是语义合理但少字的情况。[file:3]

### Tier‑3：机制信号与提出方法（Mechanism & Proposed）

- **Blank-only**：只用边界窗 blank 强度 \(b*{edge}\) 路由（\(q=b*{edge}\)）。[file:3]
- **SH‑DA++（Proposed）**：完整系统（视觉‑序列冲突 \(v*{edge}\cdot b*{edge}\) + 在线预算控制 + 专科模板 + 受限纠错/严格回填）。[file:3]

---

## D3. 指标精确定义（工程级口径）

为避免“看起来提升但不可复验”，所有对比必须遵循同一 `eval_metrics.py` 口径并在报告中附定义。[file:3]

- **Boundary Deletion Recall** \(R*{del}@B\)：在预算 \(B\) 下，经过回填/拒改后的 \(T*{final}\) 成功找回的“边缘漏字”数量 / Agent A 全部“边缘漏字”数量（漏字由 Levenshtein 对齐判定，边界区间由 \(K\_{bnd}\) 写死）。[file:3]
- **Substitution CER**：仅统计 substitution edit ops（建议限定非边界中间区域）。[file:3]
- **Token Saving Rate** \(\eta*{save}\)：\(\eta*{save}=1-\frac{Mean(Tokens*{Method})}{Mean(Tokens*{B_only})}\)，Tokens 必须来自 vLLM usage 字段（含 prompt/image/output 完整消耗），并在 backfill_log 可追溯。[file:3]
- **p95 Latency**：必须按 Stage3 统一测试协议（单卡、并发 BS=1、流式、含 warmup），否则禁止横向比较。[file:3]
- **Detection Quality（PR‑AUC）**：把 Router 当错误检测器，在边界 deletion 标签 \(y\_{del}\) 上计算 PR‑AUC。[file:3]

---

## D4. 预期检验结论（Testable Hypotheses）

所有假设必须用曲线或表格呈现（至少 B=10/20/30 三点），并给显著性检验或 bootstrap 置信区间；若暂不做显著性，也必须给方差/CI。[file:3]

### H1：边界压制力（Boundary suppression power）

在 \(B\in\{10\%,20\%,30\%\}\) 上，SH‑DA++ 的 \(R\_{del}\) 显著高于 Global avg_conf 与 NUTV，且相对提升期望 >20%。[file:3]

### H2：Pareto 最优性（CER–Budget frontier）

在 CER–Budget 曲线中，SH‑DA++ 应位于所有基线左下方（同等 CER 下预算更低，或同等预算下 CER 更低）。[file:3]

### H3：检测质量（Edge PR‑AUC superiority）

以边界 deletion 为正类时，SH‑DA++ 的 PR‑AUC 显著高于 Global avg_conf 与 NUTV，且通常也优于 PPL‑only。[file:3]

---

## D5. 诊断与排查（对比不达预期时优先查什么）

- **Blank-only 过于接近 SH‑DA++**：说明数据集中边界错误更偏“纯背景截断/裁切”，视觉边缘梯度增量小；或 \(v*{edge}\) 归一化分位参数失效导致 \(v*{edge}\) 被压扁，应先核查 edge probe 的分位统计与裁剪坐标一致性。[file:3]
- **RoI 省 token 但 CER 明显下降**：通常是 RoI 丢失必要语境（尤其 AMBIGUITY 需要左右文）；优先检查：是否仅裁 x 不裁 y、上下 padding 是否足够、Top‑2 约束是否过硬导致拒改率飙升。[file:3]
- **PPL-only 异常强/弱**：检查 Sentinel 输出是否在测试流上分布漂移；domain_label/critical_span 的 prompt 是否反向影响 B 的生成行为。[file:3]
