# L2W1 路由器配置文件
# Router Configuration for Uncertainty-based Routing

# =============================================================================
# 视觉不确定性阈值 (Visual Entropy Thresholds)
# =============================================================================
# 基于 CTC Logits 的 Shannon Entropy 计算
# 理论最大熵 = log(vocab_size) ≈ log(6625) ≈ 8.8

visual:
  # 低熵阈值：低于此值视为高置信度识别
  # 典型值: 2.0-3.0 (清晰文字)
  entropy_threshold_low: 2.0
  
  # 高熵阈值：高于此值视为低置信度识别
  # 典型值: 4.0-5.0 (模糊/复杂文字)
  entropy_threshold_high: 4.0
  
  # CTC blank 符号索引 (PaddleOCR 默认为 0)
  blank_idx: 0
  
  # 防止 log(0) 的小常数
  epsilon: 1.0e-10

# =============================================================================
# 语义不确定性阈值 (Semantic PPL Thresholds)
# =============================================================================
# 基于语言模型的困惑度评估

semantic:
  # 低 PPL 阈值：低于此值视为流畅文本
  # 典型值: 30-80 (标准中文文本)
  ppl_threshold_low: 50.0
  
  # 高 PPL 阈值：高于此值视为异常文本
  # 典型值: 150-300 (可能有识别错误)
  ppl_threshold_high: 200.0
  
  # 语言模型路径 (留空则使用简单估计)
  # 推荐: Qwen2.5-0.5B 或 ChatGLM3-6B
  model_path: ""
  
  # 是否使用 GPU
  use_gpu: true

# =============================================================================
# 路由策略 (Routing Strategy)
# =============================================================================

routing:
  # 风险等级定义
  risk_levels:
    low: "Agent A 结果可信，无需 Agent B"
    medium: "单一指标超阈值，建议 Agent B 验证"
    high: "多指标超阈值，必须 Agent B 处理"
    critical: "严重不确定性，需人工复核"
  
  # 置信度权重
  # Agent A 置信度 < 此值时，提升风险等级
  confidence_threshold: 0.8
  
  # 批量处理时的并行数
  batch_size: 32

# =============================================================================
# 输出格式 (Output Format)
# =============================================================================

output:
  # Manifest JSON 格式
  # 用于 Agent B 的显式索引提示 (EIP)
  manifest_format:
    - is_hard          # bool: 是否需要 Agent B
    - suspicious_index # int: 存疑字符位置 (0-indexed)
    - suspicious_char  # str: 存疑字符内容
    - risk_level       # str: 风险等级
    - metrics          # dict: 详细指标

# =============================================================================
# 调试选项 (Debug Options)
# =============================================================================

debug:
  # 是否打印详细日志
  verbose: false
  
  # 是否保存熵序列可视化
  save_entropy_plot: false
  
  # 可视化保存路径
  plot_save_dir: "./outputs/entropy_plots/"

